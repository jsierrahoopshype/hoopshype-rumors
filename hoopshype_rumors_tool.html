<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoopsHype Rumors Archive - 15 Years of NBA Rumors</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f4f4f4;
            color: #333;
        }
        
        /* Header */
        .header {
            background: #1a1a1a;
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 14px;
            color: #999;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Search Section */
        .search-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #e74c3c;
        }
        
        .search-hint {
            margin-top: 10px;
            font-size: 13px;
            color: #666;
        }
        
        /* Trending Section */
        .trending-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .trending-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #e74c3c;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        
        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .trending-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #e74c3c;
        }
        
        .trending-box h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .trending-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .trending-item:hover {
            background: white;
            padding-left: 5px;
        }
        
        .trending-item:last-child {
            border-bottom: none;
        }
        
        .trending-name {
            font-size: 14px;
            color: #333;
        }
        
        .trending-count {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Results Section */
        .results-header {
            background: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            color: #333;
        }
        
        .rumor-card {
            background: white;
            padding: 20px;
            margin-bottom: 2px;
            transition: background 0.2s;
        }
        
        .rumor-card:hover {
            background: #f9f9f9;
        }
        
        .rumor-card:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .rumor-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }
        
        .rumor-text {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 12px;
        }
        
        .rumor-meta {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .rumor-outlet {
            font-size: 13px;
            color: #666;
            font-style: italic;
        }
        
        .rumor-source {
            font-size: 13px;
            color: #e74c3c;
            text-decoration: none;
        }
        
        .rumor-source:hover {
            text-decoration: underline;
        }
        
        .rumor-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .rumor-tag {
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .rumor-tag:hover {
            background: #e74c3c;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .pagination button {
            padding: 10px 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .pagination button:hover {
            background: #f0f0f0;
        }
        
        .pagination button.active {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .trending-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* Related Tags Section */
        .related-tags-section {
            background: white;
            padding: 25px 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .related-tags-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .related-tags-hint {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .related-tag-btn {
            display: inline-block;
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .related-tag-btn:hover {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }
        
        .related-tag-name {
            font-weight: bold;
        }
        
        .related-tag-count {
            color: #999;
            font-size: 13px;
            margin-left: 5px;
        }
        
        .related-tag-btn:hover .related-tag-count {
            color: rgba(255,255,255,0.8);
        }
        
        /* Historical Chart Section */
        .chart-section {
            background: white;
            padding: 25px 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: none;
        }
        
        .chart-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Sentiment Indicators */
        .sentiment-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .sentiment-positive {
            background: #d4edda;
            color: #155724;
        }
        
        .sentiment-negative {
            background: #f8d7da;
            color: #721c24;
        }
        
        .sentiment-neutral {
            background: #e2e3e5;
            color: #383d41;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÄ HoopsHype Rumors Archive</h1>
        <p class="subtitle">15 Years of NBA Rumors ‚Ä¢ 606,456+ Rumors ‚Ä¢ Search & Explore</p>
    </div>
    
    <div class="container">
        <!-- Search Section -->
        <div class="search-section">
            <input type="text" 
                   class="search-box" 
                   id="searchBox" 
                   placeholder="Search rumors... (e.g., LeBron James trade, Lakers free agency, Giannis)"
                   autocomplete="off">
            <div class="search-hint">
                üí° Tip: Just type naturally - "LeBron James trade" or "Lakers, free agency" both work!
            </div>
        </div>
        
        <!-- Trending Section -->
        <div class="trending-section" id="trendingSection">
            <div class="trending-header">üî• Trending in Last 24 Hours</div>
            <div class="trending-grid">
                <div class="trending-box">
                    <h3>Top 5 Players</h3>
                    <div id="trendingPlayers">Loading...</div>
                </div>
                <div class="trending-box">
                    <h3>Top 5 Teams</h3>
                    <div id="trendingTeams">Loading...</div>
                </div>
                <div class="trending-box">
                    <h3>Hot Topics</h3>
                    <div id="trendingTopics">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Stats Bar -->
        <div class="stats-bar" id="statsBar">
            <div class="stat">
                <div class="stat-number" id="totalRumors">-</div>
                <div class="stat-label">Total Rumors</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="filteredRumors">-</div>
                <div class="stat-label">Showing</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="dateRange">-</div>
                <div class="stat-label">Years of Data</div>
            </div>
        </div>
        
        <!-- Results -->
        <div class="results-header" id="resultsHeader">
            All Rumors
        </div>
        <div id="results">
            <div class="loading">Loading rumors database...</div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination" id="pagination"></div>
        
        <!-- Related Tags -->
        <div class="related-tags-section" id="relatedTagsSection" style="display: none;">
            <div class="related-tags-header" id="relatedTagsHeader">Related Tags</div>
            <div class="related-tags-hint" id="relatedTagsHint"></div>
            <div id="relatedTagsContent"></div>
        </div>
        
        <!-- Historical Chart -->
        <div class="chart-section" id="chartSection">
            <div class="chart-header" id="chartHeader">üìä Mentions Over Time</div>
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        let allRumors = [];
        let filteredRumors = [];
        let currentPage = 1;
        const rumorsPerPage = 25;
        
        // Load data with progressive loading (handles multi-part files)
        async function loadData() {
            try {
                // Try loading index for multi-part files
                let indexResponse;
                try {
                    indexResponse = await fetch('rumors_index.json');
                } catch (e) {
                    console.log('No index file, trying single file...');
                }
                
                if (indexResponse && indexResponse.ok) {
                    // Multi-part mode with progressive loading
                    const index = await indexResponse.json();
                    const files = index.files;
                    
                    console.log(`Progressive loading: ${files.length} files total`);
                    
                    // PHASE 1: Load most recent file first (part5)
                    const recentFile = files[files.length - 1]; // part5 is last in array
                    console.log(`Loading most recent data: ${recentFile}...`);
                    
                    const recentResponse = await fetch(recentFile);
                    const recentData = await recentResponse.json();
                    allRumors = recentData;
                    
                    // Sort by date - newest to oldest
                    allRumors.sort((a, b) => {
                        return new Date(b.archive_date) - new Date(a.archive_date);
                    });
                    
                    console.log(`Loaded ${allRumors.length} recent rumors - DISPLAYING NOW`);
                    
                    // Calculate trending and display immediately
                    calculateTrending();
                    updateStats();
                    filteredRumors = allRumors;
                    displayPage(1);
                    
                    // Show loading indicator for background loading
                    document.getElementById('resultsHeader').innerHTML = 
                        `<span style="color: #e74c3c;">‚óè</span> Loading older rumors in background... (${allRumors.length.toLocaleString()} available now)`;
                    
                    // PHASE 2: Load remaining files in background
                    const remainingFiles = files.slice(0, -1); // Everything except part5
                    
                    for (let i = 0; i < remainingFiles.length; i++) {
                        const filename = remainingFiles[i];
                        console.log(`Background loading: ${filename}...`);
                        
                        try {
                            const partResponse = await fetch(filename);
                            const partData = await partResponse.json();
                            
                            // Append to existing data
                            allRumors = allRumors.concat(partData);
                            
                            // Re-sort
                            allRumors.sort((a, b) => {
                                return new Date(b.archive_date) - new Date(a.archive_date);
                            });
                            
                            // Update display
                            updateStats();
                            if (document.getElementById('searchBox').value.trim() === '') {
                                filteredRumors = allRumors;
                                if (currentPage === 1) {
                                    displayPage(1); // Refresh first page if user is still there
                                }
                            }
                            
                            // Update header
                            const remaining = remainingFiles.length - i - 1;
                            if (remaining > 0) {
                                document.getElementById('resultsHeader').innerHTML = 
                                    `<span style="color: #e74c3c;">‚óè</span> Loading... ${remaining} files remaining (${allRumors.length.toLocaleString()} rumors available)`;
                            } else {
                                document.getElementById('resultsHeader').textContent = 'All Rumors';
                                console.log(`‚úì All data loaded! Total: ${allRumors.length} rumors`);
                            }
                            
                        } catch (error) {
                            console.error(`Error loading ${filename}:`, error);
                        }
                    }
                    
                } else {
                    // Single file mode (fallback)
                    const response = await fetch('hoopshype_all_rumors.json');
                    allRumors = await response.json();
                    
                    // Sort by date - newest to oldest
                    allRumors.sort((a, b) => {
                        return new Date(b.archive_date) - new Date(a.archive_date);
                    });
                    
                    console.log(`Loaded ${allRumors.length} total rumors`);
                    
                    calculateTrending();
                    updateStats();
                    filteredRumors = allRumors;
                    displayPage(1);
                }
                
                // Setup search with debouncing
                let searchTimeout;
                const searchBox = document.getElementById('searchBox');
                
                searchBox.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(handleSearch, 500); // Wait 500ms after typing stops
                });
                
                searchBox.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        clearTimeout(searchTimeout);
                        handleSearch();
                    }
                });
                
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="no-results">Error loading data. Make sure all rumor files are in the same folder.</div>';
                console.error(error);
            }
        }
        
        // Calculate trending from last 24 hours
        function calculateTrending() {
            // Get yesterday's date as string (YYYY-MM-DD format)
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // Filter last 24 hours using string comparison
            const recentRumors = allRumors.filter(r => {
                return r.archive_date >= yesterdayStr;
            });
            
            // Count tags
            const playerCounts = {};
            const teamCounts = {};
            const topicCounts = {
                'Free Agency': 0,
                'Trade': 0,
                'Draft': 0,
                'Injuries': 0,
                'Frivolities': 0
            };
            
            // NBA teams list
            const teams = ['Atlanta Hawks', 'Boston Celtics', 'Brooklyn Nets', 'Charlotte Hornets', 
                          'Chicago Bulls', 'Cleveland Cavaliers', 'Dallas Mavericks', 'Denver Nuggets',
                          'Detroit Pistons', 'Golden State Warriors', 'Houston Rockets', 'Indiana Pacers',
                          'Los Angeles Clippers', 'Los Angeles Lakers', 'Memphis Grizzlies', 'Miami Heat',
                          'Milwaukee Bucks', 'Minnesota Timberwolves', 'New Orleans Pelicans', 'New York Knicks',
                          'Oklahoma City Thunder', 'Orlando Magic', 'Philadelphia 76ers', 'Phoenix Suns',
                          'Portland Trail Blazers', 'Sacramento Kings', 'San Antonio Spurs', 'Toronto Raptors',
                          'Utah Jazz', 'Washington Wizards'];
            
            recentRumors.forEach(rumor => {
                rumor.tags.forEach(tag => {
                    // Is it a team?
                    if (teams.includes(tag)) {
                        teamCounts[tag] = (teamCounts[tag] || 0) + 1;
                    }
                    // Is it a tracked topic?
                    else if (topicCounts.hasOwnProperty(tag)) {
                        topicCounts[tag]++;
                    }
                    // Filter out non-player tags
                    else if (tag !== 'Deaths') {
                        playerCounts[tag] = (playerCounts[tag] || 0) + 1;
                    }
                });
            });
            
            // Sort and get top 5
            const topPlayers = Object.entries(playerCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topTeams = Object.entries(teamCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topTopics = Object.entries(topicCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            // Display trending
            displayTrending('trendingPlayers', topPlayers);
            displayTrending('trendingTeams', topTeams);
            displayTrending('trendingTopics', topTopics);
        }
        
        function displayTrending(elementId, items) {
            const element = document.getElementById(elementId);
            
            if (items.length === 0 || items.every(([name, count]) => count === 0)) {
                element.innerHTML = '<div style="color: #999; font-size: 13px;">No activity in last 24 hours</div>';
                return;
            }
            
            element.innerHTML = items.map(([name, count]) => `
                <div class="trending-item" onclick="searchTag('${name.replace(/'/g, "\\'")}')">
                    <span class="trending-name">${name}</span>
                    <span class="trending-count">${count}</span>
                </div>
            `).join('');
        }
        
        function searchTag(tag) {
            document.getElementById('searchBox').value = tag;
            handleSearch();
        }
        
        function calculateRelatedTags(searchTerms) {
            // Don't show if no search or no results
            if (!searchTerms || searchTerms.length === 0 || filteredRumors.length === 0) {
                hideRelatedTags();
                return;
            }
            
            // Get date from 12 months ago
            const now = new Date();
            const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
            const oneYearAgoStr = oneYearAgo.toISOString().split('T')[0];
            
            // Filter to only recent rumors (last 12 months)
            const recentFilteredRumors = filteredRumors.filter(r => r.archive_date >= oneYearAgoStr);
            
            // Count all tags in recent filtered results
            const tagCounts = {};
            
            recentFilteredRumors.forEach(rumor => {
                (rumor.tags || []).forEach(tag => {
                    // Skip if this tag is already in the search
                    const tagLower = tag.toLowerCase();
                    const isSearchTerm = searchTerms.some(term => tagLower.includes(term));
                    
                    if (!isSearchTerm) {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    }
                });
            });
            
            // Get top 10 related tags
            const relatedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            if (relatedTags.length > 0) {
                displayRelatedTags(relatedTags, searchTerms, recentFilteredRumors.length);
            } else {
                hideRelatedTags();
            }
        }
        
        function displayRelatedTags(tags, searchTerms, recentCount) {
            const section = document.getElementById('relatedTagsSection');
            const header = document.getElementById('relatedTagsHeader');
            const hint = document.getElementById('relatedTagsHint');
            const content = document.getElementById('relatedTagsContent');
            
            // Update header based on number of search terms
            if (searchTerms.length === 1) {
                header.textContent = 'Related Tags (Last 12 Months)';
                hint.textContent = `Based on ${recentCount.toLocaleString()} recent rumors. Click to refine your search:`;
            } else {
                header.textContent = 'Smart Tag Combinations (Last 12 Months)';
                hint.textContent = `People searching for "${searchTerms.join(' + ')}" recently also looked at:`;
            }
            
            // Display tag buttons
            content.innerHTML = tags.map(([tag, count]) => `
                <div class="related-tag-btn" onclick="addTagToSearch('${tag.replace(/'/g, "\\'")}')">
                    <span class="related-tag-name">${tag}</span>
                    <span class="related-tag-count">(${count})</span>
                </div>
            `).join('');
            
            section.style.display = 'block';
        }
        
        function hideRelatedTags() {
            document.getElementById('relatedTagsSection').style.display = 'none';
        }
        
        function addTagToSearch(tag) {
            const searchBox = document.getElementById('searchBox');
            const currentSearch = searchBox.value.trim();
            
            // Add tag to current search
            if (currentSearch) {
                searchBox.value = currentSearch + ', ' + tag;
            } else {
                searchBox.value = tag;
            }
            
            handleSearch();
            
            // Scroll to top to see results
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        function handleSearch() {
            const query = document.getElementById('searchBox').value.trim().toLowerCase();
            
            if (!query) {
                filteredRumors = allRumors;
                document.getElementById('resultsHeader').textContent = 'All Rumors';
                hideRelatedTags();
                hideChart();
            } else {
                // Split by commas or spaces
                const searchTerms = query.split(/[,\s]+/).filter(t => t.length > 0);
                
                filteredRumors = allRumors.filter(rumor => {
                    // Check if ALL search terms appear in either text or tags
                    return searchTerms.every(term => {
                        const inText = rumor.text.toLowerCase().includes(term);
                        const inTags = rumor.tags.some(tag => tag.toLowerCase().includes(term));
                        return inText || inTags;
                    });
                });
                
                document.getElementById('resultsHeader').textContent = 
                    `Search Results for "${query}" (${filteredRumors.length.toLocaleString()} rumors)`;
                
                // Calculate and show related tags
                calculateRelatedTags(searchTerms);
                
                // Generate historical chart
                generateHistoricalChart(searchTerms);
            }
            
            currentPage = 1;
            updateStats();
            displayPage(1);
        }
        
        function updateStats() {
            document.getElementById('totalRumors').textContent = allRumors.length.toLocaleString();
            document.getElementById('filteredRumors').textContent = filteredRumors.length.toLocaleString();
            
            if (allRumors.length > 0) {
                const oldestDate = new Date(allRumors[allRumors.length - 1].archive_date);
                const newestDate = new Date(allRumors[0].archive_date);
                const years = Math.floor((newestDate - oldestDate) / (365 * 24 * 60 * 60 * 1000));
                document.getElementById('dateRange').textContent = `${years}+`;
            }
        }
        
        function displayPage(page) {
            currentPage = page;
            const start = (page - 1) * rumorsPerPage;
            const end = start + rumorsPerPage;
            const pageRumors = filteredRumors.slice(start, end);
            
            const results = document.getElementById('results');
            
            if (pageRumors.length === 0) {
                results.innerHTML = '<div class="no-results">No rumors found matching your search.</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            results.innerHTML = pageRumors.map(rumor => {
                // Process text to show quoted parts as hyperlinks
                let displayText = rumor.text;
                
                // Remove outlet name from end if present
                if (rumor.outlet && displayText.endsWith(rumor.outlet)) {
                    displayText = displayText.slice(0, -rumor.outlet.length).trim();
                }
                
                // If there's a quote and source URL, make the quote clickable
                if (rumor.quote && rumor.source_url && displayText.includes(rumor.quote)) {
                    const quotedLink = `<a href="${rumor.source_url}" target="_blank" class="quote-link" style="color: #e74c3c; text-decoration: none; border-bottom: 1px dotted #e74c3c;">"${rumor.quote}"</a>`;
                    // Replace the quote in the text with hyperlinked version
                    // Handle both with and without quotes around it
                    displayText = displayText.replace(`"${rumor.quote}"`, quotedLink);
                    displayText = displayText.replace(rumor.quote, quotedLink);
                }
                
                // Use date if available, otherwise format archive_date
                let displayDate = rumor.date;
                if (!displayDate || displayDate.trim() === '') {
                    if (rumor.archive_date) {
                        const dateObj = new Date(rumor.archive_date + 'T12:00:00');
                        displayDate = dateObj.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                }
                
                // Analyze sentiment
                const sentiment = analyzeSentiment(rumor.text);
                const sentimentLabel = getSentimentLabel(sentiment);
                
                return `
                <div class="rumor-card">
                    <div class="rumor-date">${displayDate || ''}${sentimentLabel}</div>
                    <div class="rumor-text">${displayText}</div>
                    <div class="rumor-meta">
                        ${rumor.outlet ? `<span class="rumor-outlet">via ${rumor.outlet}</span>` : ''}
                        ${rumor.source_url && !rumor.quote ? `<a href="${rumor.source_url}" target="_blank" class="rumor-source">Read Source ‚Üí</a>` : ''}
                    </div>
                    <div class="rumor-tags">
                        ${(rumor.tags || []).map(tag => 
                            `<span class="rumor-tag" onclick="searchTag('${tag.replace(/'/g, "\\'")}')">${tag}</span>`
                        ).join('')}
                    </div>
                </div>
            `}).join('');
            
            createPagination();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        function createPagination() {
            const totalPages = Math.ceil(filteredRumors.length / rumorsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            html += `<button onclick="displayPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Prev</button>`;
            
            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);
            
            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }
            
            if (startPage > 1) {
                html += `<button onclick="displayPage(1)">1</button>`;
                if (startPage > 2) html += `<span style="padding: 10px;">...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="${i === currentPage ? 'active' : ''}" onclick="displayPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span style="padding: 10px;">...</span>`;
                html += `<button onclick="displayPage(${totalPages})">${totalPages}</button>`;
            }
            
            html += `<button onclick="displayPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>`;
            
            pagination.innerHTML = html;
        }
        
        // Sentiment Analysis
        function analyzeSentiment(text) {
            const lowerText = text.toLowerCase();
            
            const positiveWords = [
                'sign', 'signed', 'signing', 'extension', 'extend', 'extended',
                'agree', 'agreed', 'agreement', 'deal', 'commit', 'committed',
                'happy', 'excited', 'thrilled', 'love', 'loves', 'winning',
                'win', 'won', 'victory', 'champion', 'championship', 'mvp',
                'all-star', 'allstar', 'breakout', 'impressive', 'dominant',
                'healthy', 'return', 'returning', 'comeback', 'upgrade',
                'interested', 'pursuing', 'target', 'prioritize', 'want', 'wants'
            ];
            
            const negativeWords = [
                'injury', 'injured', 'hurt', 'out', 'miss', 'missed', 'missing',
                'trade', 'traded', 'trading', 'demand', 'demanded', 'request',
                'unhappy', 'frustrated', 'angry', 'upset', 'disappointed',
                'cut', 'waive', 'waived', 'release', 'released', 'fire', 'fired',
                'lose', 'lost', 'losing', 'struggle', 'struggling', 'decline',
                'torn', 'acl', 'mcl', 'achilles', 'surgery', 'rehab',
                'suspend', 'suspended', 'suspension', 'fine', 'fined',
                'retire', 'retiring', 'retirement', 'leaving', 'leave', 'exit'
            ];
            
            let positiveScore = 0;
            let negativeScore = 0;
            
            positiveWords.forEach(word => {
                if (lowerText.includes(word)) positiveScore++;
            });
            
            negativeWords.forEach(word => {
                if (lowerText.includes(word)) negativeScore++;
            });
            
            if (positiveScore > negativeScore + 1) return 'positive';
            if (negativeScore > positiveScore + 1) return 'negative';
            return 'neutral';
        }
        
        function getSentimentLabel(sentiment) {
            switch (sentiment) {
                case 'positive':
                    return '<span class="sentiment-indicator sentiment-positive">üìà Positive</span>';
                case 'negative':
                    return '<span class="sentiment-indicator sentiment-negative">üìâ Negative</span>';
                default:
                    return '';  // Don't show neutral to reduce clutter
            }
        }
        
        // Historical Chart
        let historyChart = null;
        
        function generateHistoricalChart(searchTerms) {
            if (!searchTerms || searchTerms.length === 0 || filteredRumors.length < 10) {
                document.getElementById('chartSection').style.display = 'none';
                return;
            }
            
            // Group by month
            const monthCounts = {};
            
            filteredRumors.forEach(rumor => {
                const date = rumor.archive_date;
                const monthKey = date.substring(0, 7); // YYYY-MM
                monthCounts[monthKey] = (monthCounts[monthKey] || 0) + 1;
            });
            
            // Sort by date - show ALL months from first to last
            const sortedMonths = Object.keys(monthCounts).sort();
            
            // Find first and last date for the header
            const firstMonth = sortedMonths[0];
            const lastMonth = sortedMonths[sortedMonths.length - 1];
            
            const labels = sortedMonths.map(m => {
                const [year, month] = m.split('-');
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return `${monthNames[parseInt(month) - 1]} ${year.slice(-2)}`;
            });
            
            const data = sortedMonths.map(m => monthCounts[m]);
            
            // Format first appearance date
            const [firstYear, firstMonthNum] = firstMonth.split('-');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const firstAppearance = `${monthNames[parseInt(firstMonthNum) - 1]} ${firstYear}`;
            
            // Update chart header
            const searchText = searchTerms.join(' + ');
            document.getElementById('chartHeader').textContent = 
                `üìä "${searchText}" - ${filteredRumors.length.toLocaleString()} mentions since ${firstAppearance}`;
            
            // Show section
            document.getElementById('chartSection').style.display = 'block';
            
            // Destroy old chart if exists
            if (historyChart) {
                historyChart.destroy();
            }
            
            // Create new chart
            const ctx = document.getElementById('historyChart').getContext('2d');
            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Mentions',
                        data: data,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: sortedMonths.length > 60 ? 0 : 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw} rumors`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        },
                        x: {
                            ticks: {
                                maxTicksLimit: 15,
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function hideChart() {
            document.getElementById('chartSection').style.display = 'none';
            if (historyChart) {
                historyChart.destroy();
                historyChart = null;
            }
        }
        
        // Load on page load
        loadData();
    </script>
</body>
</html>
