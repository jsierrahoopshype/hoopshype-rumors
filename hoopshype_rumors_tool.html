<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoopsHype Rumors Archive - 15 Years of NBA Rumors</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f4f4f4;
            color: #333;
        }
        
        /* Header */
        .header {
            background: #1a1a1a;
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 14px;
            color: #999;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Search Section */
        .search-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #e74c3c;
        }
        
        .search-hint {
            margin-top: 10px;
            font-size: 13px;
            color: #666;
        }
        
        /* Trending Section */
        .trending-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .trending-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #e74c3c;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        
        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .trending-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #e74c3c;
        }
        
        .trending-box h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .trending-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .trending-item:hover {
            background: white;
            padding-left: 5px;
        }
        
        .trending-item:last-child {
            border-bottom: none;
        }
        
        .trending-name {
            font-size: 14px;
            color: #333;
        }
        
        .trending-count {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Results Section */
        .results-header {
            background: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            color: #333;
        }
        
        .rumor-card {
            background: white;
            padding: 20px;
            padding-right: 70px;
            margin-bottom: 2px;
            transition: background 0.2s;
            position: relative;
            min-height: 80px;
        }
        
        .rumor-card:hover {
            background: #fafafa;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .rumor-card:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .team-logo-right {
            position: absolute;
            right: 12px;
            top: 15px;
            width: 40px;
            height: 40px;
            opacity: 0.25;
            transition: opacity 0.2s;
        }
        
        .rumor-card:hover .team-logo-right {
            opacity: 0.5;
        }
        
        .rumor-date {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rumor-text {
            font-size: 15px;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .rumor-meta {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .rumor-outlet {
            font-size: 12px;
            color: #777;
            font-style: italic;
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .rumor-source {
            font-size: 13px;
            color: #e74c3c;
            text-decoration: none;
        }
        
        .rumor-source:hover {
            text-decoration: underline;
        }
        
        .rumor-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .rumor-tag {
            background: #f0f0f0;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .rumor-tag:hover {
            background: #e74c3c;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .pagination button {
            padding: 10px 15px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .pagination button:hover {
            background: #f0f0f0;
        }
        
        .pagination button.active {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .trending-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* Related Tags Section */
        .related-tags-section {
            background: white;
            padding: 25px 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .related-tags-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .related-tags-hint {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .related-tag-btn {
            display: inline-block;
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .related-tag-btn:hover {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }
        
        .related-tag-name {
            font-weight: bold;
        }
        
        .related-tag-count {
            color: #999;
            font-size: 13px;
            margin-left: 5px;
        }
        
        .related-tag-btn:hover .related-tag-count {
            color: rgba(255,255,255,0.8);
        }
        
        /* Historical Chart Section */
        .chart-section {
            background: white;
            padding: 25px 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: none;
        }
        
        .chart-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Sentiment Indicators */
        .sentiment-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .sentiment-positive {
            background: #d4edda;
            color: #155724;
        }
        
        .sentiment-negative {
            background: #f8d7da;
            color: #721c24;
        }
        
        .sentiment-neutral {
            background: #e2e3e5;
            color: #383d41;
        }
        
        /* Enhanced Rumor Cards */
        .rumor-card {
            background: white;
            padding: 20px 25px;
            margin-bottom: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid #e74c3c;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .rumor-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .rumor-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .team-logo {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: contain;
            background: #f8f9fa;
            padding: 4px;
        }
        
        .rumor-date {
            color: #888;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .rumor-text {
            font-size: 15px;
            line-height: 1.7;
            color: #333;
            margin-bottom: 15px;
        }
        
        .rumor-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .rumor-outlet {
            color: #666;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .rumor-outlet::before {
            content: "üì∞";
            font-size: 12px;
        }
        
        .rumor-source {
            color: #e74c3c;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }
        
        .rumor-source:hover {
            text-decoration: underline;
        }
        
        .rumor-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .rumor-tag {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #dee2e6;
        }
        
        .rumor-tag:hover {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-color: #e74c3c;
        }
        
        /* On This Day Section */
        .on-this-day-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            color: white;
        }
        
        .on-this-day-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .on-this-day-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .otd-tab {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .otd-tab:hover, .otd-tab.active {
            background: white;
            color: #667eea;
        }
        
        .otd-content {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .otd-content a {
            color: #ffd700;
        }
        
        /* Rankings Section */
        .rankings-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .rankings-header {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .rankings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .ranking-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        .ranking-card-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e74c3c;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ranking-period {
            font-size: 11px;
            color: #666;
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: auto;
        }
        
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .ranking-item:hover {
            background: #e9ecef;
            margin: 0 -10px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .ranking-item:last-child {
            border-bottom: none;
        }
        
        .ranking-position {
            width: 28px;
            height: 28px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 13px;
            margin-right: 12px;
        }
        
        .ranking-position.gold { background: #ffd700; color: #333; }
        .ranking-position.silver { background: #c0c0c0; color: #333; }
        .ranking-position.bronze { background: #cd7f32; color: white; }
        
        .ranking-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: contain;
            margin-right: 10px;
            background: white;
            padding: 3px;
        }
        
        .ranking-name {
            flex: 1;
            font-size: 14px;
            color: #333;
        }
        
        .ranking-count {
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }
        
        /* Search Rankings Section */
        .search-rankings-section {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f23 100%);
            padding: 25px 30px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
        }
        
        .search-rankings-header {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 20px;
        }
        
        .rankings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .ranking-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
        }
        
        .ranking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .ranking-period {
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .ranking-position {
            font-size: 56px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .ranking-position.top1 { color: #ffd700; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
        .ranking-position.top2 { color: #c0c0c0; text-shadow: 0 0 15px rgba(192,192,192,0.5); }
        .ranking-position.top3 { color: #cd7f32; text-shadow: 0 0 15px rgba(205,127,50,0.5); }
        .ranking-position.top10 { color: #e74c3c; text-shadow: 0 0 10px rgba(231,76,60,0.5); }
        
        .ranking-suffix {
            font-size: 18px;
            font-weight: normal;
        }
        
        .ranking-mentions {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
            margin-top: 5px;
        }
        
        .ranking-mentions strong {
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÄ HoopsHype Rumors Archive</h1>
        <p class="subtitle">15 Years of NBA Rumors ‚Ä¢ 606,456+ Rumors ‚Ä¢ Search & Explore</p>
    </div>
    
    <div class="container">
        <!-- Search Section -->
        <div class="search-section">
            <input type="text" 
                   class="search-box" 
                   id="searchBox" 
                   placeholder="Search rumors... (e.g., LeBron James trade, Lakers free agency, Giannis)"
                   autocomplete="off">
            <div class="search-hint">
                üí° Tip: Just type naturally - "LeBron James trade" or "Lakers, free agency" both work!
            </div>
        </div>
        
        <!-- Trending Section -->
        <div class="trending-section" id="trendingSection">
            <div class="trending-header">üî• Trending (Last 48 Hours)</div>
            <div class="trending-grid">
                <div class="trending-box">
                    <h3>Top 5 Players</h3>
                    <div id="trendingPlayers">Loading...</div>
                </div>
                <div class="trending-box">
                    <h3>Top 5 Teams</h3>
                    <div id="trendingTeams">Loading...</div>
                </div>
                <div class="trending-box">
                    <h3>Hot Topics</h3>
                    <div id="trendingTopics">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Results -->
        <div class="results-header" id="resultsHeader">
            All Rumors
        </div>
        <div id="results">
            <div class="loading">Loading rumors database...</div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination" id="pagination"></div>
        
        <!-- Related Tags -->
        <div class="related-tags-section" id="relatedTagsSection" style="display: none;">
            <div class="related-tags-header" id="relatedTagsHeader">Related Tags</div>
            <div class="related-tags-hint" id="relatedTagsHint"></div>
            <div id="relatedTagsContent"></div>
        </div>
        
        <!-- Historical Chart -->
        <div class="chart-section" id="chartSection">
            <div class="chart-header" id="chartHeader">üìä Mentions Over Time</div>
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
        </div>
        
        <!-- Search Rankings Section -->
        <div class="search-rankings-section" id="searchRankingsSection">
            <div class="search-rankings-header" id="searchRankingsHeader">üèÜ Rankings</div>
            <div class="rankings-grid" id="searchRankingsGrid">
                <!-- Filled dynamically -->
            </div>
        </div>
        
        <!-- On This Day Section (moved to bottom, shows when searching) -->
        <div class="on-this-day-section" id="onThisDaySection" style="display: none;">
            <div class="on-this-day-header" id="otdHeader">üìÖ On This Day in NBA Rumors</div>
            <div class="on-this-day-tabs">
                <button class="otd-tab active" onclick="showOnThisDay(1)">1 Year Ago</button>
                <button class="otd-tab" onclick="showOnThisDay(5)">5 Years Ago</button>
                <button class="otd-tab" onclick="showOnThisDay(10)">10 Years Ago</button>
            </div>
            <div class="otd-content" id="otdContent">Loading...</div>
        </div>
    </div>
    
    <script>
        let allRumors = [];
        let filteredRumors = [];
        let currentPage = 1;
        const rumorsPerPage = 25;
        
        // NBA Team Logos (using ESPN CDN)
        const teamLogos = {
            'Atlanta Hawks': 'https://a.espncdn.com/i/teamlogos/nba/500/atl.png',
            'Boston Celtics': 'https://a.espncdn.com/i/teamlogos/nba/500/bos.png',
            'Brooklyn Nets': 'https://a.espncdn.com/i/teamlogos/nba/500/bkn.png',
            'Charlotte Hornets': 'https://a.espncdn.com/i/teamlogos/nba/500/cha.png',
            'Chicago Bulls': 'https://a.espncdn.com/i/teamlogos/nba/500/chi.png',
            'Cleveland Cavaliers': 'https://a.espncdn.com/i/teamlogos/nba/500/cle.png',
            'Dallas Mavericks': 'https://a.espncdn.com/i/teamlogos/nba/500/dal.png',
            'Denver Nuggets': 'https://a.espncdn.com/i/teamlogos/nba/500/den.png',
            'Detroit Pistons': 'https://a.espncdn.com/i/teamlogos/nba/500/det.png',
            'Golden State Warriors': 'https://a.espncdn.com/i/teamlogos/nba/500/gs.png',
            'Houston Rockets': 'https://a.espncdn.com/i/teamlogos/nba/500/hou.png',
            'Indiana Pacers': 'https://a.espncdn.com/i/teamlogos/nba/500/ind.png',
            'Los Angeles Clippers': 'https://a.espncdn.com/i/teamlogos/nba/500/lac.png',
            'Los Angeles Lakers': 'https://a.espncdn.com/i/teamlogos/nba/500/lal.png',
            'Memphis Grizzlies': 'https://a.espncdn.com/i/teamlogos/nba/500/mem.png',
            'Miami Heat': 'https://a.espncdn.com/i/teamlogos/nba/500/mia.png',
            'Milwaukee Bucks': 'https://a.espncdn.com/i/teamlogos/nba/500/mil.png',
            'Minnesota Timberwolves': 'https://a.espncdn.com/i/teamlogos/nba/500/min.png',
            'New Orleans Pelicans': 'https://a.espncdn.com/i/teamlogos/nba/500/no.png',
            'New York Knicks': 'https://a.espncdn.com/i/teamlogos/nba/500/ny.png',
            'Oklahoma City Thunder': 'https://a.espncdn.com/i/teamlogos/nba/500/okc.png',
            'Orlando Magic': 'https://a.espncdn.com/i/teamlogos/nba/500/orl.png',
            'Philadelphia 76ers': 'https://a.espncdn.com/i/teamlogos/nba/500/phi.png',
            'Phoenix Suns': 'https://a.espncdn.com/i/teamlogos/nba/500/phx.png',
            'Portland Trail Blazers': 'https://a.espncdn.com/i/teamlogos/nba/500/por.png',
            'Sacramento Kings': 'https://a.espncdn.com/i/teamlogos/nba/500/sac.png',
            'San Antonio Spurs': 'https://a.espncdn.com/i/teamlogos/nba/500/sa.png',
            'Toronto Raptors': 'https://a.espncdn.com/i/teamlogos/nba/500/tor.png',
            'Utah Jazz': 'https://a.espncdn.com/i/teamlogos/nba/500/utah.png',
            'Washington Wizards': 'https://a.espncdn.com/i/teamlogos/nba/500/wsh.png'
        };
        
        // All 30 NBA teams for filtering
        const nbaTeams = Object.keys(teamLogos);
        
        // Team primary colors for badges
        const teamColors = {
            'Atlanta Hawks': '#E03A3E',
            'Boston Celtics': '#007A33',
            'Brooklyn Nets': '#000000',
            'Charlotte Hornets': '#1D1160',
            'Chicago Bulls': '#CE1141',
            'Cleveland Cavaliers': '#860038',
            'Dallas Mavericks': '#00538C',
            'Denver Nuggets': '#0E2240',
            'Detroit Pistons': '#C8102E',
            'Golden State Warriors': '#1D428A',
            'Houston Rockets': '#CE1141',
            'Indiana Pacers': '#002D62',
            'Los Angeles Clippers': '#C8102E',
            'Los Angeles Lakers': '#552583',
            'Memphis Grizzlies': '#5D76A9',
            'Miami Heat': '#98002E',
            'Milwaukee Bucks': '#00471B',
            'Minnesota Timberwolves': '#0C2340',
            'New Orleans Pelicans': '#0C2340',
            'New York Knicks': '#006BB6',
            'Oklahoma City Thunder': '#007AC1',
            'Orlando Magic': '#0077C0',
            'Philadelphia 76ers': '#006BB6',
            'Phoenix Suns': '#1D1160',
            'Portland Trail Blazers': '#E03A3E',
            'Sacramento Kings': '#5A2D81',
            'San Antonio Spurs': '#C4CED4',
            'Toronto Raptors': '#CE1141',
            'Utah Jazz': '#002B5C',
            'Washington Wizards': '#002B5C'
        };
        
        // Get team info from rumor tags
        function getTeamInfo(tags) {
            if (!tags || tags.length === 0) return null;
            for (const tag of tags) {
                if (teamColors[tag]) {
                    return { 
                        name: tag, 
                        color: teamColors[tag],
                        abbrev: getTeamAbbrev(tag)
                    };
                }
            }
            return null;
        }
        
        function getTeamAbbrev(teamName) {
            const abbrevs = {
                'Atlanta Hawks': 'ATL', 'Boston Celtics': 'BOS', 'Brooklyn Nets': 'BKN',
                'Charlotte Hornets': 'CHA', 'Chicago Bulls': 'CHI', 'Cleveland Cavaliers': 'CLE',
                'Dallas Mavericks': 'DAL', 'Denver Nuggets': 'DEN', 'Detroit Pistons': 'DET',
                'Golden State Warriors': 'GSW', 'Houston Rockets': 'HOU', 'Indiana Pacers': 'IND',
                'Los Angeles Clippers': 'LAC', 'Los Angeles Lakers': 'LAL', 'Memphis Grizzlies': 'MEM',
                'Miami Heat': 'MIA', 'Milwaukee Bucks': 'MIL', 'Minnesota Timberwolves': 'MIN',
                'New Orleans Pelicans': 'NOP', 'New York Knicks': 'NYK', 'Oklahoma City Thunder': 'OKC',
                'Orlando Magic': 'ORL', 'Philadelphia 76ers': 'PHI', 'Phoenix Suns': 'PHX',
                'Portland Trail Blazers': 'POR', 'Sacramento Kings': 'SAC', 'San Antonio Spurs': 'SAS',
                'Toronto Raptors': 'TOR', 'Utah Jazz': 'UTA', 'Washington Wizards': 'WAS'
            };
            return abbrevs[teamName] || teamName.substring(0, 3).toUpperCase();
        }
        
        // Get player initials
        function getPlayerInitials(name) {
            const parts = name.split(' ');
            if (parts.length >= 2) {
                return parts[0][0] + parts[parts.length - 1][0];
            }
            return name.substring(0, 2).toUpperCase();
        }
        
        // Get team logo from rumor tags
        function getTeamLogo(tags) {
            if (!tags || tags.length === 0) return null;
            for (const tag of tags) {
                if (teamLogos[tag]) {
                    return { name: tag, logo: teamLogos[tag] };
                }
            }
            return null;
        }
        
        // Current search terms (used by On This Day)
        let currentSearchTerms = [];
        
        // On This Day functionality - filtered by current search
        function showOnThisDay(yearsAgo) {
            // Update active tab
            document.querySelectorAll('.otd-tab').forEach(tab => tab.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            const today = new Date();
            const targetDate = new Date(today.getFullYear() - yearsAgo, today.getMonth(), today.getDate());
            const targetDateStr = targetDate.toISOString().split('T')[0];
            
            // Find rumors from that date (allow +/- 3 days)
            const startDate = new Date(targetDate.getTime() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const endDate = new Date(targetDate.getTime() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            // Filter by date AND current search terms
            let otdRumors = allRumors.filter(r => 
                r.archive_date >= startDate && r.archive_date <= endDate
            );
            
            // If we have search terms, filter by them
            if (currentSearchTerms.length > 0) {
                otdRumors = otdRumors.filter(rumor => {
                    return currentSearchTerms.every(term => {
                        const inText = rumor.text.toLowerCase().includes(term);
                        const inTags = rumor.tags.some(tag => tag.toLowerCase().includes(term));
                        return inText || inTags;
                    });
                });
            }
            
            const content = document.getElementById('otdContent');
            const searchText = currentSearchTerms.length > 0 ? ` about "${currentSearchTerms.join(' + ')}"` : '';
            
            if (otdRumors.length === 0) {
                content.innerHTML = `<em>No rumors found${searchText} from ${targetDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}.</em>`;
                return;
            }
            
            // Pick the most relevant rumor (prefer ones with more tags)
            const sortedByTags = otdRumors.sort((a, b) => (b.tags?.length || 0) - (a.tags?.length || 0));
            const topRumor = sortedByTags[0];
            
            const rumorDate = new Date(topRumor.archive_date + 'T12:00:00');
            const dateStr = rumorDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            
            // Truncate text if too long
            let displayText = topRumor.text;
            if (displayText.length > 300) {
                displayText = displayText.substring(0, 300) + '...';
            }
            
            content.innerHTML = `
                <strong>${dateStr}</strong> (${otdRumors.length} rumors${searchText} that day)<br><br>
                "${displayText}"<br><br>
                <span style="opacity: 0.8;">‚Äî via ${topRumor.outlet || 'Unknown'}</span>
            `;
        }
        
        function updateOnThisDay() {
            // Only show On This Day when searching
            const section = document.getElementById('onThisDaySection');
            const header = document.getElementById('otdHeader');
            
            if (currentSearchTerms.length > 0) {
                const searchText = currentSearchTerms.join(' + ');
                header.innerHTML = `üìÖ On This Day: "${searchText}"`;
                section.style.display = 'block';
                showOnThisDay(1); // Default to 1 year ago
            } else {
                section.style.display = 'none';
            }
        }
        
        
        // Rankings calculations
        function calculateRankings() {
            const now = new Date();
            const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()).toISOString().split('T')[0];
            const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate()).toISOString().split('T')[0];
            
            // Filter rumors by time period
            const lastMonth = allRumors.filter(r => r.archive_date >= oneMonthAgo);
            const lastYear = allRumors.filter(r => r.archive_date >= oneYearAgo);
            
            // Calculate player rankings
            calculateTagRankings(lastMonth, 'player', 'rankingPlayersMonth');
            calculateTagRankings(lastYear, 'player', 'rankingPlayersYear');
            calculateTagRankings(allRumors, 'player', 'rankingPlayersAllTime');
            
            // Calculate team rankings
            calculateTagRankings(lastMonth, 'team', 'rankingTeamsMonth');
            calculateTagRankings(lastYear, 'team', 'rankingTeamsYear');
            calculateTagRankings(allRumors, 'team', 'rankingTeamsAllTime');
        }
        
        function calculateTagRankings(rumors, type, elementId) {
            const tagCounts = {};
            
            rumors.forEach(rumor => {
                (rumor.tags || []).forEach(tag => {
                    const isTeam = nbaTeams.includes(tag);
                    
                    if (type === 'team' && isTeam) {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    } else if (type === 'player' && !isTeam && !isNonPlayerTag(tag)) {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    }
                });
            });
            
            const sorted = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const element = document.getElementById(elementId);
            
            if (sorted.length === 0) {
                element.innerHTML = '<em>No data available</em>';
                return;
            }
            
            element.innerHTML = sorted.map(([name, count], index) => {
                const posClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const logo = type === 'team' ? teamLogos[name] : null;
                
                return `
                    <div class="ranking-item" onclick="searchTag('${name.replace(/'/g, "\\'")}')">
                        <div class="ranking-position ${posClass}">${index + 1}</div>
                        ${logo ? `<img src="${logo}" class="ranking-logo" alt="${name}" onerror="this.style.display='none'">` : ''}
                        <div class="ranking-name">${name}</div>
                        <div class="ranking-count">${count.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
        }
        
        function isNonPlayerTag(tag) {
            const nonPlayerTags = [
                'Trade Rumors', 'Free Agency', 'Injuries', 'NBA Draft', 'Contracts',
                'Coaching', 'Front Office', 'Suspensions', 'Retirements', 'G League',
                'International', 'Awards', 'All-Star', 'Playoffs', 'Finals',
                'Summer League', 'Training Camp', 'Preseason'
            ];
            return nonPlayerTags.some(t => tag.toLowerCase().includes(t.toLowerCase()));
        }
        
        
        // Load data with progressive loading (handles multi-part files)
        async function loadData() {
            try {
                // Try loading index for multi-part files
                let indexResponse;
                try {
                    indexResponse = await fetch('rumors_index.json');
                } catch (e) {
                    console.log('No index file, trying single file...');
                }
                
                if (indexResponse && indexResponse.ok) {
                    // Multi-part mode with progressive loading
                    const index = await indexResponse.json();
                    const files = index.files;
                    
                    console.log(`Progressive loading: ${files.length} files total`);
                    
                    // PHASE 1: Load most recent file first (last part)
                    const recentFile = files[files.length - 1]; // Last part is most recent
                    console.log(`Loading most recent data: ${recentFile}...`);
                    
                    const recentResponse = await fetch(recentFile);
                    const recentData = await recentResponse.json();
                    allRumors = recentData;
                    
                    // Sort by date - newest to oldest
                    allRumors.sort((a, b) => {
                        return new Date(b.archive_date) - new Date(a.archive_date);
                    });
                    
                    console.log(`Loaded ${allRumors.length} recent rumors - DISPLAYING NOW`);
                    
                    // Calculate trending and display immediately
                    calculateTrending();
                    filteredRumors = allRumors;
                    displayPage(1);
                    
                    // Show loading indicator for background loading
                    document.getElementById('resultsHeader').innerHTML = 
                        `<span style="color: #e74c3c;">‚óè</span> Loading older rumors in background... (${allRumors.length.toLocaleString()} available now)`;
                    
                    // PHASE 2: Load remaining files in background
                    const remainingFiles = files.slice(0, -1); // Everything except part5
                    
                    for (let i = 0; i < remainingFiles.length; i++) {
                        const filename = remainingFiles[i];
                        console.log(`Background loading: ${filename}...`);
                        
                        try {
                            const partResponse = await fetch(filename);
                            const partData = await partResponse.json();
                            
                            // Append to existing data
                            allRumors = allRumors.concat(partData);
                            
                            // Re-sort
                            allRumors.sort((a, b) => {
                                return new Date(b.archive_date) - new Date(a.archive_date);
                            });
                            
                            // Update display
                            if (document.getElementById('searchBox').value.trim() === '') {
                                filteredRumors = allRumors;
                                if (currentPage === 1) {
                                    displayPage(1); // Refresh first page if user is still there
                                }
                            }
                            
                            // Update header
                            const remaining = remainingFiles.length - i - 1;
                            if (remaining > 0) {
                                document.getElementById('resultsHeader').innerHTML = 
                                    `<span style="color: #e74c3c;">‚óè</span> Loading... ${remaining} files remaining (${allRumors.length.toLocaleString()} rumors available)`;
                            } else {
                                document.getElementById('resultsHeader').textContent = 'All Rumors';
                                console.log(`‚úì All data loaded! Total: ${allRumors.length} rumors`);
                            }
                            
                        } catch (error) {
                            console.error(`Error loading ${filename}:`, error);
                        }
                    }
                    
                } else {
                    // Single file mode (fallback)
                    const response = await fetch('hoopshype_all_rumors.json');
                    allRumors = await response.json();
                    
                    // Sort by date - newest to oldest
                    allRumors.sort((a, b) => {
                        return new Date(b.archive_date) - new Date(a.archive_date);
                    });
                    
                    console.log(`Loaded ${allRumors.length} total rumors`);
                    
                    calculateTrending();
                    calculateRankings();
                    filteredRumors = allRumors;
                    displayPage(1);
                }
                
                // Setup search with debouncing
                let searchTimeout;
                const searchBox = document.getElementById('searchBox');
                
                searchBox.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(handleSearch, 500); // Wait 500ms after typing stops
                });
                
                searchBox.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        clearTimeout(searchTimeout);
                        handleSearch();
                    }
                });
                
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div class="no-results">Error loading data. Make sure all rumor files are in the same folder.</div>';
                console.error(error);
            }
        }
        
        // Calculate trending from last 24 hours
        function calculateTrending() {
            // Get date from 48 hours ago (wider window for timezone safety)
            const now = new Date();
            const twoDaysAgo = new Date(now.getTime() - 48 * 60 * 60 * 1000);
            const twoDaysAgoStr = twoDaysAgo.toISOString().split('T')[0];
            
            // Filter last 48 hours using string comparison
            const recentRumors = allRumors.filter(r => {
                return r.archive_date >= twoDaysAgoStr;
            });
            
            console.log('[TRENDING DEBUG] Recent rumors:', recentRumors.length, 'from date >=', twoDaysAgoStr);
            
            // Count tags
            const playerCounts = {};
            const teamCounts = {};
            const topicCounts = {
                'Free Agency': 0,
                'Trade': 0,
                'Draft': 0,
                'Injuries': 0,
                'Frivolities': 0
            };
            
            // NBA teams list
            const teams = ['Atlanta Hawks', 'Boston Celtics', 'Brooklyn Nets', 'Charlotte Hornets', 
                          'Chicago Bulls', 'Cleveland Cavaliers', 'Dallas Mavericks', 'Denver Nuggets',
                          'Detroit Pistons', 'Golden State Warriors', 'Houston Rockets', 'Indiana Pacers',
                          'Los Angeles Clippers', 'Los Angeles Lakers', 'Memphis Grizzlies', 'Miami Heat',
                          'Milwaukee Bucks', 'Minnesota Timberwolves', 'New Orleans Pelicans', 'New York Knicks',
                          'Oklahoma City Thunder', 'Orlando Magic', 'Philadelphia 76ers', 'Phoenix Suns',
                          'Portland Trail Blazers', 'Sacramento Kings', 'San Antonio Spurs', 'Toronto Raptors',
                          'Utah Jazz', 'Washington Wizards'];
            
            recentRumors.forEach(rumor => {
                (rumor.tags || []).forEach(tag => {
                    // Is it a team?
                    if (teams.includes(tag)) {
                        teamCounts[tag] = (teamCounts[tag] || 0) + 1;
                    }
                    // Is it a tracked topic?
                    else if (topicCounts.hasOwnProperty(tag)) {
                        topicCounts[tag]++;
                    }
                    // Filter out non-player tags
                    else if (tag !== 'Deaths') {
                        playerCounts[tag] = (playerCounts[tag] || 0) + 1;
                    }
                });
            });
            
            // Sort and get top 5
            const topPlayers = Object.entries(playerCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topTeams = Object.entries(teamCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const topTopics = Object.entries(topicCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            // Display trending
            displayTrending('trendingPlayers', topPlayers);
            displayTrending('trendingTeams', topTeams);
            displayTrending('trendingTopics', topTopics);
        }
        
        function displayTrending(elementId, items) {
            const element = document.getElementById(elementId);
            
            if (items.length === 0 || items.every(([name, count]) => count === 0)) {
                element.innerHTML = '<div style="color: #999; font-size: 13px;">No activity in last 48 hours</div>';
                return;
            }
            
            element.innerHTML = items.map(([name, count]) => `
                <div class="trending-item" onclick="searchTag('${name.replace(/'/g, "\\'")}')">
                    <span class="trending-name">${name}</span>
                    <span class="trending-count">${count}</span>
                </div>
            `).join('');
        }
        
        function searchTag(tag) {
            document.getElementById('searchBox').value = tag;
            handleSearch();
        }
        
        function calculateRelatedTags(searchTerms) {
            // Don't show if no search or no results
            if (!searchTerms || searchTerms.length === 0 || filteredRumors.length === 0) {
                hideRelatedTags();
                return;
            }
            
            // Get date from 12 months ago
            const now = new Date();
            const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
            const oneYearAgoStr = oneYearAgo.toISOString().split('T')[0];
            
            // Filter to only recent rumors (last 12 months)
            const recentFilteredRumors = filteredRumors.filter(r => r.archive_date >= oneYearAgoStr);
            
            // Count all tags in recent filtered results
            const tagCounts = {};
            
            recentFilteredRumors.forEach(rumor => {
                (rumor.tags || []).forEach(tag => {
                    // Skip if this tag is already in the search
                    const tagLower = tag.toLowerCase();
                    const isSearchTerm = searchTerms.some(term => tagLower.includes(term));
                    
                    if (!isSearchTerm) {
                        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                    }
                });
            });
            
            // Get top 10 related tags
            const relatedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            if (relatedTags.length > 0) {
                displayRelatedTags(relatedTags, searchTerms, recentFilteredRumors.length);
            } else {
                hideRelatedTags();
            }
        }
        
        function displayRelatedTags(tags, searchTerms, recentCount) {
            const section = document.getElementById('relatedTagsSection');
            const header = document.getElementById('relatedTagsHeader');
            const hint = document.getElementById('relatedTagsHint');
            const content = document.getElementById('relatedTagsContent');
            
            // Update header based on number of search terms
            if (searchTerms.length === 1) {
                header.textContent = 'Related Tags (Last 12 Months)';
                hint.textContent = `Based on ${recentCount.toLocaleString()} recent rumors. Click to refine your search:`;
            } else {
                header.textContent = 'Smart Tag Combinations (Last 12 Months)';
                hint.textContent = `People searching for "${searchTerms.join(' + ')}" recently also looked at:`;
            }
            
            // Display tag buttons
            content.innerHTML = tags.map(([tag, count]) => `
                <div class="related-tag-btn" onclick="addTagToSearch('${tag.replace(/'/g, "\\'")}')">
                    <span class="related-tag-name">${tag}</span>
                    <span class="related-tag-count">(${count})</span>
                </div>
            `).join('');
            
            section.style.display = 'block';
        }
        
        function hideRelatedTags() {
            document.getElementById('relatedTagsSection').style.display = 'none';
        }
        
        function addTagToSearch(tag) {
            const searchBox = document.getElementById('searchBox');
            const currentSearch = searchBox.value.trim();
            
            // Add tag to current search
            if (currentSearch) {
                searchBox.value = currentSearch + ', ' + tag;
            } else {
                searchBox.value = tag;
            }
            
            handleSearch();
            
            // Scroll to top to see results
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        function handleSearch() {
            const query = document.getElementById('searchBox').value.trim().toLowerCase();
            
            if (!query) {
                filteredRumors = allRumors;
                currentSearchTerms = [];
                document.getElementById('resultsHeader').textContent = 'All Rumors';
                hideRelatedTags();
                hideChart();
                hideSearchRankings();
                updateOnThisDay();
            } else {
                // Split by commas or spaces
                const searchTerms = query.split(/[,\s]+/).filter(t => t.length > 0);
                currentSearchTerms = searchTerms;
                
                filteredRumors = allRumors.filter(rumor => {
                    // Check if ALL search terms appear in either text or tags
                    return searchTerms.every(term => {
                        const inText = rumor.text.toLowerCase().includes(term);
                        const inTags = rumor.tags.some(tag => tag.toLowerCase().includes(term));
                        return inText || inTags;
                    });
                });
                
                document.getElementById('resultsHeader').textContent = 
                    `Search Results for "${query}" (${filteredRumors.length.toLocaleString()} rumors)`;
                
                // Calculate and show related tags
                calculateRelatedTags(searchTerms);
                
                // Generate historical chart
                generateHistoricalChart(searchTerms);
                
                // Calculate and show rankings
                calculateSearchRankings(searchTerms);
                
                // Update On This Day
                updateOnThisDay();
            }
            
            currentPage = 1;
            displayPage(1);
        }
        
        function displayPage(page) {
            currentPage = page;
            const start = (page - 1) * rumorsPerPage;
            const end = start + rumorsPerPage;
            const pageRumors = filteredRumors.slice(start, end);
            
            const results = document.getElementById('results');
            
            if (pageRumors.length === 0) {
                results.innerHTML = '<div class="no-results">No rumors found matching your search.</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            results.innerHTML = pageRumors.map(rumor => {
                // Process text to show quoted parts as hyperlinks
                let displayText = rumor.text;
                
                // Remove outlet name from end if present
                if (rumor.outlet && displayText.endsWith(rumor.outlet)) {
                    displayText = displayText.slice(0, -rumor.outlet.length).trim();
                }
                
                // If there's a quote and source URL, make the quote clickable
                if (rumor.quote && rumor.source_url && displayText.includes(rumor.quote)) {
                    const quotedLink = `<a href="${rumor.source_url}" target="_blank" class="quote-link" style="color: #e74c3c; text-decoration: none; border-bottom: 1px dotted #e74c3c;">"${rumor.quote}"</a>`;
                    // Replace the quote in the text with hyperlinked version
                    // Handle both with and without quotes around it
                    displayText = displayText.replace(`"${rumor.quote}"`, quotedLink);
                    displayText = displayText.replace(rumor.quote, quotedLink);
                }
                
                // Use date if available, otherwise format archive_date
                let displayDate = rumor.date;
                if (!displayDate || displayDate.trim() === '') {
                    if (rumor.archive_date) {
                        const dateObj = new Date(rumor.archive_date + 'T12:00:00');
                        displayDate = dateObj.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                }
                
                // Analyze sentiment
                const sentiment = analyzeSentiment(rumor.text);
                const sentimentLabel = getSentimentLabel(sentiment);
                
                // Get team logo for right side
                const teamInfo = getTeamLogo(rumor.tags);
                const teamLogoHTML = teamInfo ? 
                    `<img src="${teamInfo.logo}" class="team-logo-right" alt="${teamInfo.name}" onerror="this.style.display='none'">` : '';
                
                return `
                <div class="rumor-card">
                    ${teamLogoHTML}
                    <div class="rumor-date">${displayDate || ''}${sentimentLabel}</div>
                    <div class="rumor-text">${displayText}</div>
                    <div class="rumor-meta">
                        ${rumor.outlet ? `<span class="rumor-outlet">via ${rumor.outlet}</span>` : ''}
                        ${rumor.source_url && !rumor.quote ? `<a href="${rumor.source_url}" target="_blank" class="rumor-source">Read Source ‚Üí</a>` : ''}
                    </div>
                    <div class="rumor-tags">
                        ${(rumor.tags || []).map(tag => 
                            `<span class="rumor-tag" onclick="searchTag('${tag.replace(/'/g, "\\'")}')">${tag}</span>`
                        ).join('')}
                    </div>
                </div>
            `}).join('');
            
            createPagination();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        function createPagination() {
            const totalPages = Math.ceil(filteredRumors.length / rumorsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            html += `<button onclick="displayPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Prev</button>`;
            
            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);
            
            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }
            
            if (startPage > 1) {
                html += `<button onclick="displayPage(1)">1</button>`;
                if (startPage > 2) html += `<span style="padding: 10px;">...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="${i === currentPage ? 'active' : ''}" onclick="displayPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span style="padding: 10px;">...</span>`;
                html += `<button onclick="displayPage(${totalPages})">${totalPages}</button>`;
            }
            
            html += `<button onclick="displayPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>`;
            
            pagination.innerHTML = html;
        }
        
        // Sentiment Analysis
        function analyzeSentiment(text) {
            const lowerText = text.toLowerCase();
            
            const positiveWords = [
                'sign', 'signed', 'signing', 'extension', 'extend', 'extended',
                'agree', 'agreed', 'agreement', 'deal', 'commit', 'committed',
                'happy', 'excited', 'thrilled', 'love', 'loves', 'winning',
                'win', 'won', 'victory', 'champion', 'championship', 'mvp',
                'all-star', 'allstar', 'breakout', 'impressive', 'dominant',
                'healthy', 'return', 'returning', 'comeback', 'upgrade',
                'interested', 'pursuing', 'target', 'prioritize', 'want', 'wants'
            ];
            
            const negativeWords = [
                'injury', 'injured', 'hurt', 'out', 'miss', 'missed', 'missing',
                'trade', 'traded', 'trading', 'demand', 'demanded', 'request',
                'unhappy', 'frustrated', 'angry', 'upset', 'disappointed',
                'cut', 'waive', 'waived', 'release', 'released', 'fire', 'fired',
                'lose', 'lost', 'losing', 'struggle', 'struggling', 'decline',
                'torn', 'acl', 'mcl', 'achilles', 'surgery', 'rehab',
                'suspend', 'suspended', 'suspension', 'fine', 'fined',
                'retire', 'retiring', 'retirement', 'leaving', 'leave', 'exit'
            ];
            
            let positiveScore = 0;
            let negativeScore = 0;
            
            positiveWords.forEach(word => {
                if (lowerText.includes(word)) positiveScore++;
            });
            
            negativeWords.forEach(word => {
                if (lowerText.includes(word)) negativeScore++;
            });
            
            if (positiveScore > negativeScore + 1) return 'positive';
            if (negativeScore > positiveScore + 1) return 'negative';
            return 'neutral';
        }
        
        function getSentimentLabel(sentiment) {
            switch (sentiment) {
                case 'positive':
                    return '<span class="sentiment-indicator sentiment-positive">üìà Positive</span>';
                case 'negative':
                    return '<span class="sentiment-indicator sentiment-negative">üìâ Negative</span>';
                default:
                    return '';  // Don't show neutral to reduce clutter
            }
        }
        
        // Historical Chart
        let historyChart = null;
        
        function generateHistoricalChart(searchTerms) {
            if (!searchTerms || searchTerms.length === 0 || filteredRumors.length < 10) {
                document.getElementById('chartSection').style.display = 'none';
                return;
            }
            
            // Group by month
            const monthCounts = {};
            
            filteredRumors.forEach(rumor => {
                const date = rumor.archive_date;
                const monthKey = date.substring(0, 7); // YYYY-MM
                monthCounts[monthKey] = (monthCounts[monthKey] || 0) + 1;
            });
            
            // Sort by date - show ALL months from first to last
            const sortedMonths = Object.keys(monthCounts).sort();
            
            console.log('[CHART DEBUG] Total months:', sortedMonths.length);
            console.log('[CHART DEBUG] First month:', sortedMonths[0]);
            console.log('[CHART DEBUG] Last month:', sortedMonths[sortedMonths.length - 1]);
            
            // Find first and last date for the header
            const firstMonth = sortedMonths[0];
            const lastMonth = sortedMonths[sortedMonths.length - 1];
            
            const labels = sortedMonths.map(m => {
                const [year, month] = m.split('-');
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return `${monthNames[parseInt(month) - 1]} ${year.slice(-2)}`;
            });
            
            const data = sortedMonths.map(m => monthCounts[m]);
            
            // Format first appearance date
            const [firstYear, firstMonthNum] = firstMonth.split('-');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const firstAppearance = `${monthNames[parseInt(firstMonthNum) - 1]} ${firstYear}`;
            
            // Update chart header
            const searchText = searchTerms.join(' + ');
            document.getElementById('chartHeader').textContent = 
                `üìä "${searchText}" - ${filteredRumors.length.toLocaleString()} mentions since ${firstAppearance}`;
            
            // Show section
            document.getElementById('chartSection').style.display = 'block';
            
            // Destroy old chart if exists
            if (historyChart) {
                historyChart.destroy();
            }
            
            // Create new chart
            const ctx = document.getElementById('historyChart').getContext('2d');
            historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Mentions',
                        data: data,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: sortedMonths.length > 60 ? 0 : 2,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw} rumors`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        },
                        x: {
                            ticks: {
                                maxTicksLimit: 15,
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        function hideChart() {
            document.getElementById('chartSection').style.display = 'none';
            if (historyChart) {
                historyChart.destroy();
                historyChart = null;
            }
        }
        
        // Search Rankings Functions
        function calculateSearchRankings(searchTerms) {
            if (!searchTerms || searchTerms.length === 0 || filteredRumors.length < 5) {
                hideSearchRankings();
                return;
            }
            
            // Find the matching tag (player or team)
            const searchQuery = searchTerms.join(' ').toLowerCase();
            let matchedTag = null;
            let isTeam = false;
            
            // Check if search matches a team
            for (const team of nbaTeams) {
                if (team.toLowerCase().includes(searchQuery) || searchQuery.includes(team.toLowerCase().split(' ').pop())) {
                    matchedTag = team;
                    isTeam = true;
                    break;
                }
            }
            
            // If not a team, look for player in tags
            if (!matchedTag) {
                const tagCounts = {};
                filteredRumors.forEach(r => {
                    (r.tags || []).forEach(tag => {
                        if (!nbaTeams.includes(tag) && tag.toLowerCase().includes(searchQuery)) {
                            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        }
                    });
                });
                const sorted = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
                if (sorted.length > 0) {
                    matchedTag = sorted[0][0];
                }
            }
            
            if (!matchedTag) {
                hideSearchRankings();
                return;
            }
            
            // Calculate rankings for different periods
            const now = new Date();
            const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()).toISOString().split('T')[0];
            const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate()).toISOString().split('T')[0];
            
            const periods = [
                { name: 'Past Week', after: oneWeekAgo },
                { name: 'Past Month', after: oneMonthAgo },
                { name: 'Past Year', after: oneYearAgo }
            ];
            
            const rankings = periods.map(period => {
                const periodRumors = allRumors.filter(r => r.archive_date >= period.after);
                
                // Count all tags in this period
                const tagCounts = {};
                periodRumors.forEach(r => {
                    (r.tags || []).forEach(tag => {
                        // Filter by same type (team or player)
                        if (isTeam && nbaTeams.includes(tag)) {
                            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        } else if (!isTeam && !nbaTeams.includes(tag)) {
                            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        }
                    });
                });
                
                // Sort and find rank
                const sorted = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
                const rank = sorted.findIndex(([tag]) => tag === matchedTag) + 1;
                const mentions = tagCounts[matchedTag] || 0;
                const total = sorted.length;
                
                return {
                    period: period.name,
                    rank: rank || 'N/A',
                    mentions: mentions,
                    total: total
                };
            });
            
            // Display rankings
            const section = document.getElementById('searchRankingsSection');
            const header = document.getElementById('searchRankingsHeader');
            const grid = document.getElementById('searchRankingsGrid');
            
            header.innerHTML = `üèÜ "${matchedTag}" Rankings ${isTeam ? '(Team)' : '(Player)'}`;
            
            grid.innerHTML = rankings.map(r => {
                const rankClass = r.rank === 1 ? 'top1' : r.rank === 2 ? 'top2' : r.rank === 3 ? 'top3' : r.rank <= 10 ? 'top10' : '';
                const suffix = r.rank === 1 ? 'st' : r.rank === 2 ? 'nd' : r.rank === 3 ? 'rd' : 'th';
                
                return `
                    <div class="ranking-card">
                        <div class="ranking-period">${r.period}</div>
                        <div class="ranking-position ${rankClass}">
                            ${r.rank !== 'N/A' ? r.rank : '‚Äî'}<span class="ranking-suffix">${r.rank !== 'N/A' ? suffix : ''}</span>
                        </div>
                        <div class="ranking-mentions">
                            <strong>${r.mentions.toLocaleString()}</strong> mentions
                        </div>
                    </div>
                `;
            }).join('');
            
            section.style.display = 'block';
        }
        
        function hideSearchRankings() {
            document.getElementById('searchRankingsSection').style.display = 'none';
        }
        
        // Load on page load
        loadData();
    </script>
</body>
</html>
